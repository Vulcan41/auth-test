<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Auth Test</title>
  <style>
    body { font-family: sans-serif; max-width: 760px; margin: 40px auto; }
    input { width: 100%; padding: 8px; margin: 6px 0; }
    button { padding: 8px 12px; margin-right: 8px; margin-top: 6px; }
    pre { background: #f6f6f6; padding: 12px; overflow: auto; }
    .row { display: flex; gap: 16px; }
    .col { flex: 1; }
    .small { opacity: 0.75; font-size: 12px; }
  </style>
</head>
<body>
<h1>Supabase Auth Test (Plain HTML)</h1>
<p class="small">Goal: sign in/out and call <code>/api/me</code> using the session token.</p>

<div class="row">
  <div class="col">
    <h3>Login</h3>
    <input id="email" type="email" placeholder="Email" />
    <input id="password" type="password" placeholder="Password" />
    <div>
      <button id="signup">Sign up</button>
      <button id="signin">Sign in</button>
      <button id="signout">Sign out</button>
    </div>
  </div>
  <div class="col">
    <h3>Status</h3>
    <div id="status">Not signed in</div>
    <div>
      <button id="callme">Call /api/me</button>
    </div>
  </div>
</div>

<h3>Output</h3>
<pre id="out">{}</pre>

<script src="https://unpkg.com/@supabase/supabase-js@2"></script>

<script>

const SUPABASE_URL = "https://lexrhvnqfuxgecjwdmoo.supabase.co";
const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImxleHJodm5xZnV4Z2VjandkbW9vIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjY5NDg5NDMsImV4cCI6MjA4MjUyNDk0M30.OnAZb4MHHQj43W94MurV5d0R0NP5lxXNcwmLefZFaG0";

const sb = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

const $ = (id) => document.getElementById(id);
const out = (obj) => ($("out").textContent = JSON.stringify(obj, null, 2));

async function refreshStatus() {
const { data: { session } } = await sb.auth.getSession();
$("status").textContent = session
? `Signed in as ${session.user.email}`
: "Not signed in";
return session;
}

$("signup").onclick = async () => {
const email = $("email").value.trim();
const password = $("password").value;
const { data, error } = await sb.auth.signUp({ email, password });
out({ action: "signUp", data, error });
await refreshStatus();
};

$("signin").onclick = async () => {
const email = $("email").value.trim();
const password = $("password").value;
const { data, error } = await sb.auth.signInWithPassword({ email, password });
out({ action: "signIn", data, error });
await refreshStatus();
};

$("signout").onclick = async () => {
const { error } = await sb.auth.signOut();
out({ action: "signOut", ok: !error, error });
await refreshStatus();
};

$("callme").onclick = async () => {
const { data: { session } } = await sb.auth.getSession();
if (!session) return out({ error: "Not signed in" });

const res = await fetch("/api/me", {
headers: { Authorization: `Bearer ${session.access_token}` }
});

const json = await res.json().catch(() => ({}));
out({ status: res.status, json });
};

sb.auth.onAuthStateChange(() => refreshStatus());
refreshStatus();

</script>

</body>
</html>
